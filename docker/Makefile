# https://docs.docker.com/compose/reference/overview

.PHONY: start
start:
  # starts the entire runtime infrastructure
	docker-compose up -d ssl

.PHONY: db
db:
	docker-compose up -d db

.PHONY: ui
ui:
	docker-compose up -d ui

.PHONY: api
api:
	docker-compose up -d api

.PHONY: ssl
ssl: # http://localhost => https://localhost
	docker-compose up -d ssl

.PHONY: mail
mail:
	docker-compose up -d mail

.PHONY: tests
tests:
	docker-compose run -p 9003:9003 --workdir="/var/www" api sh -c "/wait && ln -s html src && html/vendor/bin/phpunit --configuration test/php/phpunit.xml"

.PHONY: db-reset
db-reset:
	docker-compose run --workdir="/var/www/scripts/tools" api sh -c "/wait && php FactoryReset.php run"

.PHONY: clean
clean:
	docker-compose kill
	docker-compose rm -f
	docker system prune -f
  # by default volumes are not pruned.  To prune volumes as well, do:
  # docker system prune -f --volumes
