<div class="col-md-5" oncopy="return false;">
    <h2 class="pull-left" data-ng-show="text.audioFileName && audioReady">
        <a data-sgw-sound-player data-href="audioPlayUrl" data-sgw-state="state">
            <i data-ng-class="$parent.audioIcon()" data-tooltip="Play audio"></i></a>
        <a data-ng-show="project.allowAudioDownload" data-ng-href="{{audioDownloadUrl}}">
            <i class="fa fa-download" data-tooltip="Download audio"></i></a>
    </h2>
    <h2>{{text.title}}</h2>
    <div id="text" style="font-family: {{text.fontfamily}}" data-sil-selection data-sil-selected-text="selectedText" content="text.content"></div>
</div>
<div id="comments" class="col-md-6" data-ng-show="finishedLoading">
    <div class="question">
        <h2>{{questionTitleCalculated}}</h2>
        <h4 data-ng-show="questionIsClosed()"
            style="color: gray; font-style: italic">This question is marked
            closed</h4>
        <div>{{question.description}}</div>
        <a href data-ng-show="rightsEditQuestion()"
            data-ng-click="toggleQuestionEditor()">Edit Question Settings</a>
        <div class="edit-question" uib-collapse="editQuestionCollapsed">
            <form class="card">
                <fieldset class="card-block">
                    <label class="form-group">Question
                        <textarea required data-ng-model="editedQuestion.description" class="form-control col-md-4"
                            rows="4" placeholder="The Question"></textarea>
                    </label>
                    <label class="form-group">Title
                        <input type="text" data-ng-model="editedQuestion.title" class="form-control col-md-4"
                            maxlength="35" placeholder="One-line Summary For Title" />
                    </label>
                    <label class="form-group">Workflow
                        <select class="form-control" data-ng-model="editedQuestion.workflowState"
                            data-ng-options="s.state as s.label for s in workflowStates"
                            name="workflowState"></select>
                    </label>
                    <button class="btn btn-success"
                        data-ng-click="updateQuestion(editedQuestion); hideQuestionEditor()">
                        <i class="fa fa-check"></i> Save</button>
                    <button class="btn btn-warning" data-ng-click="hideQuestionEditor()">
                        <i class="fa fa-times"></i> Cancel</button>
                </fieldset>
            </form>
        </div>
        <div data-ng-show="question.answerCount == 0 && !questionIsClosed()">
            There are no answers yet for this question. You could be the first one to reply!</div>
        <br />
    </div>
    <div class="new-answer">
        <div data-ng-hide="questionIsClosed()">
            <form data-ng-submit="submitAnswer()">
                Add your own answer<span data-ng-show="newAnswer.textHighlight">
                about this part of the text</span>:
                <div class="scripture-quote" oncopy="return false;" data-ng-show="newAnswer.textHighlight"
                     data-ng-bind-html="newAnswer.textHighlight"></div>

                <div class="form-group">
                    <textarea required data-ng-model="newAnswer.content" class="newAnswer form-control"
                        placeholder='Type your answer here. Click "Save Answer" when finished.'></textarea>
                </div>
                <div data-ng-hide="unreadResponseCount() == 0" class="right badge badge-important">
                    {{unreadResponseCount()}} new response<span data-ng-show="unreadResponseCount() > 1">s</span>
                </div>
                <button type="submit" class="btn btn-success" id="doneBtn">Save Answer</button>
            </form>
        </div>
    </div>
    <div id="answers">
        <div data-ng-repeat="(answerId, answer) in question.answers">
            <div class="vote">
                <a data-ng-class="{disabled: votes[answerId] == true || questionIsClosed()}"
                    data-ng-click="voteUp(answerId)"><i class="fa fa-caret-up fa-3x"></i></a>
                <span class="vote-count">{{answer.score}}</span>
                <a data-ng-class="{disabled: votes[answerId] != true || questionIsClosed()}"
                    data-ng-click="voteDown(answerId)"><i class="fa fa-caret-down fa-3x"></i></a>
            </div>
            <div>
                <div data-ng-class="{unread: isUnreadAnswer(answerId)}" class="answer">
                    <!--<b>DEBUG:</b>answerId = {{answerId}}, answer.id = {{answer.id}}<br/>-->
                    <!--<b>DEBUG:</b>answer = {{answer}}<br/>-->
                    <div data-ng-show="answer.textHighlight" data-ng-bind-html="answer.textHighlight"
                        class="scripture-quote"></div>
                    <div class="answerContent" data-ng-bind-html="answer.content"></div>
                    <div class="answer-footer">
                        <div data-view-tags data-ng-show="$parent.rightsCreateTag()"
                            data-tags="answer.tags" data-on-delete="deletedTags(answer)"
                            data-rights-delete="rightsDeleteTag()"></div>
                        <div class="author">
                            <img data-ng-src="{{getAvatarUrl(answer.userRef.avatar_ref)}}" width="32" height="32" />
                            <div>
                                Answered {{answer.dateCreated | date:mediumDate}}<br />
                                by {{answer.userRef.username}}
                            </div>
                        </div>
                        <div class="answerControls">
                            <a href data-ng-show="rightsCreateTag() && !questionIsClosed()"
                                data-ng-click="tagEditorVisible=true">tag</a>&nbsp;&nbsp;
                            <a href data-ng-show="rightsEditResponse(answer.userRef.userid) && !questionIsClosed()"
                                data-ng-click="showAnswerEditor(answerId)">edit</a>&nbsp;&nbsp;
                            <a href data-ng-show="rightsDeleteResponse(answer.userRef.userid) && !questionIsClosed()"
                                data-ng-click="answerDelete(answerId)">delete</a>&nbsp;&nbsp;
                            <a href data-ng-show="rightsExport() && !questionIsClosed()"
                                data-ng-click="flagForExport(answer)">
                                <i data-ng-show="answer.isToBeExported" class="fa fa-flag" data-tooltip="Flagged for export"
                                    style="color: red"></i>
                                <i data-ng-show="!answer.isToBeExported" class="fa fa-flag-o"
                                    data-tooltip="Click to flag for export"></i></a>
                        </div>
                        <div data-ng-switch data-on="answerEditorVisible(answerId)">
                            <form data-ng-submit="editAnswer(editedAnswer)" data-ng-switch-when="true">
                                <label><textarea required data-ng-model="editedAnswer.content" class="editAnswer form-control">
                                    </textarea></label>
                                <button type="submit" class="btn btn-sm btn-success answerBtn"> <i class="fa fa-check"></i>Save </button>
                                <a href data-ng-click="hideAnswerEditor()">Cancel</a>
                            </form>
                        </div>
                        <div class="overlay" data-ng-show="tagEditorVisible">
                            <div class="overlay-bg">
                                <form
                                        data-ng-submit="addTags(tags, answer);tagEditorVisible=false">
                                    <label>Add tags (comma-separated)
                                        <add-tags tags="tags"></add-tags>
                                    </label>
                                    <button type="submit" class="btn btn-sm btn-success">
                                        <i class="fa fa-check"></i> Save</button>
                                    <a href data-ng-click="tagEditorVisible=false">Cancel</a>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="comments">
                        <div data-ng-repeat="comment in answer.comments">
                            <div data-ng-class="{unread: isUnreadComment(comment.id)}">
                                {{comment.content}} -
                                {{comment.userRef.username}} -
                                {{comment.dateCreated | date:mediumdate}}
                                <a href data-ng-show="rightsEditResponse(comment.userRef.userid) && !questionIsClosed()"
                                   data-ng-click="showCommentEditor(comment.id)">edit</a>&nbsp;
                                <a href data-ng-show="rightsDeleteResponse(comment.userRef.userid) && !questionIsClosed()"
                                   data-ng-click="commentDelete(answer, comment.id)">delete</a>
                                <div data-ng-switch data-on="commentEditorVisible(comment.id)">
                                    <form data-ng-submit="editComment(answerId, answer, editedComment)"
                                          data-ng-switch-when="true">
                                        <div class="form-group">
                                            <label><textarea class="form-control" required data-ng-model="editedComment.content"></textarea></label>
                                            <button type="submit" class="btn btn-sm btn-success">Save</button>
                                            <a href data-ng-click="hideCommentEditor()">Cancel</a>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div data-ng-hide="questionIsClosed()">
                            <a href data-ng-click="collapsed = !collapsed" class="addCommentLink">
                                add comment</a>
                            <div uib-collapse="!collapsed">
                                <form data-ng-submit="submitComment(answerId, answer); collapsed = !collapsed;">
                                    <label class="form-group"><textarea class="form-control" required data-ng-model="newComment.content"></textarea></label>
                                    <button type="submit" class="btn btn-sm btn-success save-new-comment">Save Comment</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
