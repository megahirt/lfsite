!function(a,b){"use strict";function c(a){if(a=a[0],a.previousElementSibling)return b.element(a.previousElementSibling);for(var c=a.previousSibling;null!=c&&1!=c.nodeType;)c=c.previousSibling;return b.element(c)}function d(a,b){var d=c(a);d.length>0?d.after(b):a.parent().prepend(b)}function e(a,c){return a instanceof b.element&&(a=a[0]),null!==h?a[h](c):void 0}var f=b.module("angular-sortable-view",[]);f.directive("svRoot",[function(){function c(a,b,c){return c?a.x-b.x<0:a.y-b.y<0}function f(a){return i[a]}function g(a){delete i[a]}var h,i=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate",function(j,k,l){function m(){var a={top:document.body.scrollTop,left:document.body.scrollLeft},b={x:a.left-w.left,y:a.top-w.top};r&&r[0].reposition(b),w=a}var n=l(k.svRoot)(j)||j.$id;i[n]||(i[n]=[]);var o,p,q,r,s,t,u=!1;this.sortingInProgress=function(){return h},j.$watchCollection(function(){return f(n)},function(a){u=!1;var b=a.filter(function(a){return!a.container}).map(function(a){return{part:a.getPart().id,y:a.element[0].getBoundingClientRect().top}}),c=Object.create(null);b.forEach(function(a){c[a.part]?c[a.part].push(a.y):c[a.part]=[a.y]}),Object.keys(c).forEach(function(a){c[a].sort(),c[a].forEach(function(b,d){d<c[a].length-1&&b>0&&b===c[a][d+1]&&(u=!0)})})}),this.$moveUpdate=function(a,b,g,i,j){var k=g[0].getBoundingClientRect();"element"===a.tolerance&&(b={x:~~(k.left+k.width/2),y:~~(k.top+k.height/2)}),h=!0,o=[],p||(j?(p=j.clone(),p.removeClass("ng-hide")):(p=i.clone(),p.addClass("sv-visibility-hidden"),p.addClass("sv-placeholder"),p.css({height:k.height+"px",width:k.width+"px"})),i.after(p),i.addClass("ng-hide").addClass("sv-source"),i.removeClass("sv-visibility-hidden"),s=i,q=a,r=g),r[0].reposition({x:b.x+document.body.scrollLeft-b.offset.x*k.width,y:b.y+document.body.scrollTop-b.offset.y*k.height},!0),f(n).forEach(function(d){if(null==a.containment||e(d.element,a.containment)||e(d.element,a.containment+" *")){var f=d.element[0].getBoundingClientRect(),g={x:~~(f.left+f.width/2),y:~~(f.top+f.height/2)};d.container||!d.element[0].scrollHeight&&!d.element[0].scrollWidth||o.push({element:d.element,q:(g.x-b.x)*(g.x-b.x)+(g.y-b.y)*(g.y-b.y),view:d.getPart(),targetIndex:d.getIndex(),after:c(g,b,u)}),d.container&&!d.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&o.push({element:d.element,q:(g.x-b.x)*(g.x-b.x)+(g.y-b.y)*(g.y-b.y),view:d.getPart(),targetIndex:0,container:!0})}});var l=p[0].getBoundingClientRect(),m={x:~~(l.left+l.width/2),y:~~(l.top+l.height/2)};o.push({q:(m.x-b.x)*(m.x-b.x)+(m.y-b.y)*(m.y-b.y),element:p,placeholder:!0}),o.sort(function(a,b){return a.q-b.q}),o.forEach(function(a,b){0!==b||a.placeholder||a.container?0===b&&a.container?(t=a,a.element.append(p)):a.element.removeClass("sv-candidate"):(t=a,a.element.addClass("sv-candidate"),a.after?a.element.after(p):d(a.element,p))})},this.$drop=function(a,b,c){function d(){if(h=!1,p.remove(),r.remove(),s.removeClass("ng-hide").removeClass("sv-source"),o=void 0,p=void 0,c=void 0,r=void 0,s=void 0,t){t.element.removeClass("sv-candidate");var d=a.model(a.scope).splice(b,1),e=t.targetIndex;t.view===a&&t.targetIndex>b&&e--,t.after&&e++,t.view.model(t.view.scope).splice(e,0,d[0]),j.$root.$$phase||j.$apply()}t=void 0}if(c.revert){var e=p[0].getBoundingClientRect();["-webkit-","-moz-","-ms-","-o-",""].forEach(function(a){"undefined"!=typeof r[0].style[a+"transition"]&&(r[0].style[a+"transition"]="all "+c.revert+"ms ease")}),setTimeout(d,+c.revert),r.css({top:e.top+document.body.scrollTop+"px",left:e.left+document.body.scrollLeft+"px"})}else d()},this.addToSortableElements=function(a){f(n).push(a)},this.removeFromSortableElements=function(a){var b=f(n),c=b.indexOf(a);c>-1&&(b.splice(c,1),0===b.length&&g(n))};var v=b.element(a);v.on("scroll",m),j.$on("$destroy",function(){v.off("off",m)});var w={top:document.body.scrollTop,left:document.body.scrollLeft}}]}}]),f.directive("svPart",["$parse",function(a){return{restrict:"A",require:"^svRoot",controller:["$scope",function(a){a.$ctrl=this,this.getPart=function(){return a.part},this.$drop=function(b,c){a.$sortableRoot.$drop(a.part,b,c)}}],scope:!0,link:function(b,c,d,e){if(!d.svPart)throw new Error("no model provided");var f=a(d.svPart);if(!f.assign)throw new Error("model not assignable");b.part={id:b.$id,element:c,model:f,scope:b},b.$sortableRoot=e;var g={element:c,getPart:b.$ctrl.getPart,container:!0};e.addToSortableElements(g),b.$on("$destroy",function(){e.removeFromSortableElements(g)})}}}]),f.directive("svElement",["$parse",function(a){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(a){a.$ctrl=this}],link:function(c,d,e,f){function g(g){function h(a){f[1].$moveUpdate(i,{x:a.clientX,y:a.clientY,offset:r},o,d,k)}if(!f[1].sortingInProgress()&&0==g.button){var i=a(e.svElement)(c);if(i=b.extend({},{tolerance:"pointer",revert:200,containment:"html"},i),i.containment)var n=document.querySelector(i.containment).getBoundingClientRect();var o,p=d,q=d[0].getBoundingClientRect();j||(j=f[0].helper),k||(k=f[0].placeholder),j?(o=j.clone(),o.removeClass("ng-hide"),o.css({left:q.left+document.body.scrollLeft+"px",top:q.top+document.body.scrollTop+"px"}),p.addClass("sv-visibility-hidden")):(o=p.clone(),o.addClass("sv-helper").css({left:q.left+document.body.scrollLeft+"px",top:q.top+document.body.scrollTop+"px",width:q.width+"px"})),l.append(o),o[0].reposition=function(a,b){var c=b?0:+this.style.left.slice(0,-2),d=b?0:+this.style.top.slice(0,-2),e=c+a.x,f=d+a.y,g=o[0].getBoundingClientRect(),h=document.body;n&&(f<n.top+h.scrollTop&&(f=n.top+h.scrollTop),f+g.height>n.top+h.scrollTop+n.height&&(f=n.top+h.scrollTop+n.height-g.height),e<n.left+h.scrollLeft&&(e=n.left+h.scrollLeft),e+g.width>n.left+h.scrollLeft+n.width&&(e=n.left+h.scrollLeft+n.width-g.width)),this.style.left=e+"px",this.style.top=f+"px"};var r={x:(g.clientX-q.left)/q.width,y:(g.clientY-q.top)/q.height};m.addClass("sv-sorting-in-progress"),m.on("mousemove",h).on("mouseup",function s(){m.off("mousemove",h),m.off("mouseup",s),m.removeClass("sv-sorting-in-progress"),f[0].$drop(c.$index,i)}),h(g)}}var h={element:d,getPart:f[0].getPart,getIndex:function(){return c.$index}};f[1].addToSortableElements(h),c.$on("$destroy",function(){f[1].removeFromSortableElements(h)});var i=d;i.on("mousedown",g),c.$watch("$ctrl.handle",function(a){a&&(i.off("mousedown",g),i=a,i.on("mousedown",g))});var j;c.$watch("$ctrl.helper",function(a){a&&(j=a)});var k;c.$watch("$ctrl.placeholder",function(a){a&&(k=a)});var l=b.element(document.body),m=b.element(document.documentElement)}}}]),f.directive("svHandle",function(){return{require:"?^svElement",link:function(a,b,c,d){d&&(d.handle=b)}}}),f.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-helper").addClass("ng-hide"),d[1]?d[1].helper=b:d[0]&&(d[0].helper=b)}}}),f.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(a,b,c,d){b.addClass("sv-placeholder").addClass("ng-hide"),d[1]?d[1].placeholder=b:d[0]&&(d[0].placeholder=b)}}}),b.element(document.head).append(["<style>.sv-helper{position: absolute;z-index: 99999;margin: 0 !important;pointer-events: none;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var g=document.documentElement,h=g.matches?"matches":g.matchesSelector?"matchesSelector":g.webkitMatches?"webkitMatches":g.webkitMatchesSelector?"webkitMatchesSelector":g.msMatches?"msMatches":g.msMatchesSelector?"msMatchesSelector":g.mozMatches?"mozMatches":g.mozMatchesSelector?"mozMatchesSelector":null;if(null==h)throw"This browser doesn't support the HTMLElement.matches method"}(window,window.angular);