<div class="container" data-ng-cloak data-ng-controller="ViewSettingsCtrl">
<h2>{{'View Settings' | translate}}</h2>
<form name="viewSettingForm" novalidate>
<fieldset data-ng-disabled="isSaving">
<button class="btn btn-primary {{interfaceConfig.pullToSide}}" data-ng-click="settingsApply()"  
	data-ng-disabled="viewSettingForm.$pristine || !allRolesHaveAtLeastOneSense() || !allUsersHaveAtLeastOneSense() || isSaving">
	<i class="icon-ok"></i> {{'Apply' | translate}}</button>
<tabset>
	<tab data-ng-repeat="roleTab in roleTabs" class="{{interfaceConfig.pullNormal}}" active="roleTab.active"
		data-ng-click="selectField(currentField.name, roleTab.view)">
		<tab-heading>{{roleTab.name | translate}}
			<span data-ng-hide="isAtLeastOneSense(roleTab.view)">
				<img src="/images/shared/exclamation.png" 
					title="{{'At least one Meaning field must be enabled!' | translate}}"
					style="padding-left: 5px;"/></span>
		</tab-heading>
		<accordion close-others="true">
		<accordion-group is-open="true">
		<accordion-heading><h3 translate="Enabled Fields"></h3></accordion-heading>
			<div class="row outer-flex">
			
			<!-- Left column: field view select list -->
			<div class="span3 control-group">
				
				<!-- control buttons -->
                <div class="control-group">
                    <button data-ng-click="showAllFields = ! showAllFields" class="btn btn-small">{{showAllFields ? 'Show Only Common Fields' : 'Show All Fields' | translate}}</button>
                </div>

				<!-- select list -->
				<dl class="picklists" style="height: 200px; overflow: auto;">
					<dt translate="Entry Level Fields"></dt>
					<dd><div class="controls">
						<div data-ng-repeat="fieldName in configDirty.entry.fieldOrder"
							data-ng-class="{selected:currentField.name == fieldName}">
							<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
								data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
								data-ng-click="selectField(fieldName, roleTab.view)">
								{{fieldConfig[fieldName].label}}</span>
						</div>
					</div></dd>
					<dt>{{'Meaning Level Fields' | translate}}
						<span data-ng-hide="isAtLeastOneSense(roleTab.view)">
						<img src="/images/shared/exclamation.png" 
							title="{{'At least one Meaning field must be enabled!' | translate}}"
							style="position: absolute; padding-left: 5px;"/></span></dt>
					<dd><div class="controls">
						<div data-ng-repeat="fieldName in configDirty.entry.fields.senses.fieldOrder"
							data-ng-class="{selected:currentField.name == fieldName}">
							<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
								data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
								data-ng-click="selectField(fieldName, roleTab.view)">
								{{fieldConfig[fieldName].label}}</span>
						</div>
					</div></dd>
					<dt translate="Example Level Fields"></dt>
					<dd><div class="controls">
						<div data-ng-repeat="fieldName in configDirty.entry.fields.senses.fields.examples.fieldOrder"
							data-ng-class="{selected:currentField.name == fieldName}">
							<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
								data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
								data-ng-click="selectField(fieldName, roleTab.view)">
								{{fieldConfig[fieldName].label}}</span>
						</div>
					</div></dd>
				</dl>
				<small translate="Custom Fields shown in <i>italics</i>"></small>
			</div>
		
			<!-- Right column: field view settings -->
			<div class="span9 control-group">

				<!-- settings -->
				<div class="well">
					<h3>{{fieldConfig[currentField.name].label}} {{'Field View Settings' | translate}}</h3>
					<div class="control-group">
						<div class="controls">
							<label class="checkbox {{interfaceConfig.pullNormal}}">
								<input type="checkbox" 
									data-ng-disabled="currentField.name == 'lexeme'" 
									data-ng-model="roleTab.view.fields[currentField.name].show"/>
								{{'Show field' | translate}}</label>
						</div>
						<br />
					</div>
					<!-- 
					<div data-ng-show="roleTab.view.fields[currentField.name].type === 'multitext'">
						<div class="control-group">
							<div class="controls">
								<label class="checkbox {{interfaceConfig.pullNormal}}">
									<input type="checkbox" 
										data-ng-model="roleTab.view.fields[currentField.name].overrideInputSystems"/>
									{{'Override Input Systems' | translate}}</label>
								<br />
							</div>
						</div>
						<div data-ng-show="roleTab.view.fields[currentField.name].overrideInputSystems">
							<hr />
							<div class="row outer-flex control-group">
								<div class="span3 picklists">
									<label class="control-label" for="inputSystem">{{'Input Systems' | translate}}</label>
									<ul class="unstyled indent1"  id="inputSystem">
										<li data-ng-click="currentField.inputSystems.tag = inputSystemTag" 
											data-ng-repeat="inputSystemTag in currentField.inputSystems.fieldOrder" 
											data-ng-class="{selected:currentField.inputSystems.tag == inputSystemTag}">
											<div class="checkbox"><input data-ng-model="currentField.inputSystems.selecteds[inputSystemTag]" type="checkbox"/>
												{{configDirty.inputSystems[inputSystemTag].abbreviation}}</div>
										</li>
									</ul>
								</div>
								<div class="span1 btn-group btn-group-vertical">
									<button class="btn" data-ng-click="moveUp(currentField.inputSystems.tag, roleTab.view)" 
										data-ng-disabled="currentField.inputSystems.fieldOrder[0] == currentField.inputSystems.tag || !currentField.inputSystems.tag">
										&nbsp;&nbsp;<i class="icon-arrow-up"></i></button>
									<button class="btn" data-ng-click="moveDown(currentField.inputSystems.tag, roleTab.view)" 
										data-ng-disabled="currentField.inputSystems.fieldOrder[currentField.inputSystems.fieldOrder.length - 1] == currentField.inputSystems.tag || !currentField.inputSystems.tag">
										&nbsp;&nbsp;<i class="icon-arrow-down"></i></button>
								</div>
							</div>
						</div>
					</div>
					 -->
				</div>
<!-- 
<pre>
roleTab.view.fields[currentField.name].inputSystems {{roleTab.view.fields[currentField.name].inputSystems | json}}
currentField {{currentField | json}}
</pre>				
 -->				
			</div>
		
			</div>
		</accordion-group>
		<accordion-group>
			<accordion-heading><h3 translate="Enabled Tasks"></h3></accordion-heading>
			<div class="row outer-flex">
			
			<!-- Left column: task view settings -->
			<div class="span4 control-group">
				<dl>
					<dt translate="Dashboard"></dt>
					<dd><div class="controls">
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['dashboard']">
							{{'Dashboard' | translate}}</label>
					</div></dd>
					<dt translate="Dictionary"></dt>
					<dd><div class="controls">
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['dbe']">
							{{'Browse &amp; Edit' | translate}}</label>
					</div></dd>
					<dt translate="Add Information"></dt>
					<dd><div class="controls">
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['addMeanings']">
							{{'add Meanings' | translate}}</label>
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['addGrammar']">
							{{'add Grammatical Usage (Part of Speech)' | translate}}</label>
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['addExamples']">
							{{'add Examples' | translate}}</label>
					</div></dd>
					<dt translate="Gather Words"></dt>
					<dd><div class="controls">
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['gatherTexts']">
							{{'from Texts' | translate}}</label>
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['wordlist']">
							{{'from a Word List' | translate}}</label>
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['semdom']">
							{{'from Semantic Domains' | translate}}</label>
					</div></dd>
					<dt translate="Review"></dt>
					<dd><div class="controls">
						<label class="checkbox"><input type="checkbox" data-ng-model="roleTab.view.showTasks['review']">
							{{'Review' | translate}}</label>
					</div></dd>
				</dl>
			</div>
				
			</div>
		</accordion-group>
	</accordion>
	</tab>
	<tab data-ng-click="selectField(currentField.name, configDirty.userViews[currentUserId])">
		<tab-heading>{{'Member Specific' | translate}}
			<span data-ng-hide="allUsersHaveAtLeastOneSense()">
				<img src="/images/shared/exclamation.png" 
					title="{{'At least one Meaning field must be enabled!' | translate}}"
					style="padding-left: 5px;"/></span>
		</tab-heading>
		<div data-ng-show="state === 'userSelectList'">

			<!-- control buttons -->
			<form class="form-inline">
				<typeahead class="typeahead" items="typeahead.users" term="typeahead.userName" search="typeahead.searchUsers" select="typeahead.selectUser">
					<ul>
						<li class="typeahead-item" typeahead-item="user" data-ng-repeat="user in typeahead.users">
							<img width="32px" data-ng-src="{{imageSource(user.avatarRef)}}" class="left">
							<p class="name">{{user.name}}</p>
							<p class="email">{{user.email}}</p>
						</li>
					</ul>
				</typeahead>
				<button class="btn btn-success" data-ng-click="addUser()"><i class="icon-plus"></i>{{'Add Member Specific Settings' | translate}}</button>
				<br /><br />
			</form>
		
			<div class="row outer-flex">
			
				<!-- Left column: user select list -->
				<div class="span3 control-group picklists">
						<ul class="unstyled">
							<li data-ng-click="selectUser(userId)" data-ng-repeat="(userId, userView) in configDirty.userViews" 
								data-ng-class="{selected:currentUserId == userId}"> 
								{{usersWithSettings[userId].name}} ({{usersWithSettings[userId].username}})
								<span data-ng-hide="isAtLeastOneSense(userView)">
									<img src="/images/shared/exclamation.png" 
										title="{{'At least one Meaning field must be enabled!' | translate}}"
										style="padding-left: 5px;"/></span>
							</li>
						</ul>
				</div>
				
			</div>
		</div>
		<div data-ng-show="state === 'userSettings'">
			<h2 style="margin-left: 0px; margin-bottom: 24px;">
				{{usersWithSettings[currentUserId].name}} ({{usersWithSettings[currentUserId].username}}) View Settings</h2>
			
			<!-- control buttons -->
			<div class="row outer-flex">
				<div class="span3 control-group">
					<button class="btn" data-ng-click="goSelectUser()"><i class="icon-chevron-left"></i> {{'Select Member' | translate}}</button>
				</div>
				<div class="span9 control-group" style="height: 30px">
					<button class="btn" data-ng-click="removeSelectedMemberSettings()">
						<i class="icon-remove"></i> {{'Remove Member Specific Settings' | translate}} </button>
				</div>
			</div>
			
			<accordion close-others="true">
			<accordion-group is-open="true">
			<accordion-heading><h3 translate="Enabled Fields"></h3></accordion-heading>
				<div class="row outer-flex">
				
				<!-- Left column: field view select list -->
				<div class="span3 control-group">
					
					<!-- control buttons -->
					<div class="control-group">
						<a href="" data-ng-click="showAllFields = ! showAllFields">
							{{showAllFields ? 'Show Common Fields' : 'Show All Fields' | translate}}</a>
					</div>
					
					<!-- select list -->
					<dl class="picklists" style="height: 200px; overflow: auto;">
						<dt translate="Entry Level Fields"></dt>
						<dd><div class="controls">
							<div data-ng-repeat="fieldName in configDirty.entry.fieldOrder"
								data-ng-class="{selected:currentField.name == fieldName}">
								<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
									data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
									data-ng-click="selectField(fieldName, configDirty.userViews[currentUserId])">
									{{fieldConfig[fieldName].label}}</span>
							</div>
						</div></dd>
						<dt>{{'Meaning Level Fields' | translate}}
							<span data-ng-hide="isAtLeastOneSense(configDirty.userViews[currentUserId])">
							<img src="/images/shared/exclamation.png" 
								title="{{'At least one Meaning field must be enabled!' | translate}}"
								style="position: absolute; padding-left: 5px;"/></span></dt>
						<dd><div class="controls">
							<div data-ng-repeat="fieldName in configDirty.entry.fields.senses.fieldOrder"
								data-ng-class="{selected:currentField.name == fieldName}">
								<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
									data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
									data-ng-click="selectField(fieldName, configDirty.userViews[currentUserId])">
									{{fieldConfig[fieldName].label}}</span>
							</div>
						</div></dd>
						<dt translate="Example Level Fields"></dt>
						<dd><div class="controls">
							<div data-ng-repeat="fieldName in configDirty.entry.fields.senses.fields.examples.fieldOrder"
								data-ng-class="{selected:currentField.name == fieldName}">
								<span data-ng-hide="fieldIsHidden(fieldName, showAllFields)"
									data-ng-style="{'font-style': isCustomField(fieldName) ? 'italic' : 'normal'}"
									data-ng-click="selectField(fieldName, configDirty.userViews[currentUserId])">
									{{fieldConfig[fieldName].label}}</span>
							</div>
						</div></dd>
					</dl>
					<small translate="Custom Fields shown in <i>italics</i>"></small>
				</div>
			
				<!-- Right column: field view settings -->
				<div class="span9 control-group">
					
					<!-- settings -->
					<div class="well">
						<h3>{{fieldConfig[currentField.name].label}} {{'Field View Settings' | translate}}</h3>
						<div class="control-group">
							<div class="controls">
								<label class="checkbox {{interfaceConfig.pullNormal}}">
									<input type="checkbox" 
										data-ng-disabled="currentField.name == 'lexeme'" 
										data-ng-model="configDirty.userViews[currentUserId].fields[currentField.name].show"/>
									{{'Show field' | translate}}</label>
							</div>
							<br />
						</div>
						<!-- 
						<div data-ng-show="configDirty.userViews[currentUserId].fields[currentField.name].type === 'multitext'">
							<div class="control-group">
								<div class="controls">
									<label class="checkbox {{interfaceConfig.pullNormal}}">
										<input type="checkbox" 
											data-ng-model="configDirty.userViews[currentUserId].fields[currentField.name].overrideInputSystems"/>
										{{'Override Input Systems' | translate}}</label>
									<br />
								</div>
							</div>
							<div data-ng-show="configDirty.userViews[currentUserId].fields[currentField.name].overrideInputSystems">
								<hr />
								<div class="row outer-flex control-group">
									<div class="span3 picklists">
										<label class="control-label" for="inputSystem">{{'Input Systems' | translate}}</label>
										<ul class="unstyled indent1"  id="inputSystem">
											<li data-ng-click="currentField.inputSystems.tag = inputSystemTag" 
												data-ng-repeat="inputSystemTag in currentField.inputSystems.fieldOrder" 
												data-ng-class="{selected:currentField.inputSystems.tag == inputSystemTag}">
												<div class="checkbox"><input data-ng-model="currentField.inputSystems.selecteds[inputSystemTag]" type="checkbox"/>
													{{configDirty.inputSystems[inputSystemTag].abbreviation}}</div>
											</li>
										</ul>
									</div>
									<div class="span1 btn-group btn-group-vertical">
										<button class="btn" data-ng-click="moveUp(currentField.inputSystems.tag, configDirty.userViews[currentUserId])" 
											data-ng-disabled="currentField.inputSystems.fieldOrder[0] == currentField.inputSystems.tag || !currentField.inputSystems.tag">
											&nbsp;&nbsp;<i class="icon-arrow-up"></i></button>
										<button class="btn" data-ng-click="moveDown(currentField.inputSystems.tag, configDirty.userViews[currentUserId])" 
											data-ng-disabled="currentField.inputSystems.fieldOrder[currentField.inputSystems.fieldOrder.length - 1] == currentField.inputSystems.tag || !currentField.inputSystems.tag">
											&nbsp;&nbsp;<i class="icon-arrow-down"></i></button>
									</div>
								</div>
							</div>
						</div>
						 -->
					</div>
<!--  
<pre>
configDirty.userViews[currentUserId].fields[currentField.name].inputSystems {{configDirty.userViews[currentUserId].fields[currentField.name].inputSystems | json}}
currentField {{currentField | json}}
</pre>					
 -->				
				</div>
			
				</div>
			</accordion-group>
			<accordion-group>
				<accordion-heading><h3 translate="Enabled Tasks"></h3></accordion-heading>
				<div class="row outer-flex">
				
				<!-- Left column: task view settings -->
				<div class="span4 control-group">
					<dl>
						<dt translate="Dashboard"></dt>
						<dd><div class="controls">
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['dashboard']">
								{{'Dashboard' | translate}}</label>
						</div></dd>
						<dt translate="Dictionary"></dt>
						<dd><div class="controls">
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['dbe']">
								{{'Browse &amp; Edit' | translate}}</label>
						</div></dd>
						<dt translate="Add Information"></dt>
						<dd><div class="controls">
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['addMeanings']">
								{{'add Meanings' | translate}}</label>
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['addGrammar']">
								{{'add Grammatical Usage (Part of Speech)' | translate}}</label>
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['addExamples']">
								{{'add Examples' | translate}}</label>
						</div></dd>
						<dt translate="Gather Words"></dt>
						<dd><div class="controls">
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['gatherTexts']">
								{{'from Texts' | translate}}</label>
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['wordlist']">
								{{'from a Word List' | translate}}</label>
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['semdom']">
								{{'from Semantic Domains' | translate}}</label>
						</div></dd>
						<dt translate="Review"></dt>
						<dd><div class="controls">
							<label class="checkbox"><input type="checkbox" data-ng-model="configDirty.userViews[currentUserId].showTasks['review']">
								{{'Review' | translate}}</label>
						</div></dd>
					</dl>
				</div>
					
				</div>
			</accordion-group>
		</accordion>
		
		</div>
	</tab>
</tabset>
</fieldset>
</form>
<!-- 
<pre>
roleTabs {{roleTabs | json}}
configDirty.roleViews {{configDirty.roleViews | json}}
currentUserId {{currentUserId | json}}
currentField {{currentField | json}}
configDirty.userViews {{configDirty.userViews | json}}
</pre>
 -->
</div>

